<!doctype html>
<html>
<head>
    <title>Processes</title>

    <style>
        body {
            color: #d3d3d3;
            font: 12pt arial;
            background-color: #222222;
        }

        #network1 {
            width: 800px;
            height: 300px;
            border: 1px solid #444444;
            background-color: #222222;
        }

        #network2 {
            width: 800px;
            height: 300px;
            border: 1px solid #444444;
            background-color: #e2e4e6;
        }


        #showAll {
            width: 100px;
            height: 20px;
            background: red;
            color: white;
        }
    </style>

    <script src="../js/jquery.min.js"></script>
    <script src="../js/vis.min.js"></script>
    <link href="../css/vis-network.min.css" rel="stylesheet" type="text/css"/>

</head>

<body>
<div id="showAll">show All</div>
<div id="network1"></div>
<div id="network2"></div>

<script>

    var processNetwork, taskNetwork, tasksInfo;

    $(function () {
        $.ajax({
            url: '/api/processes',
            type: 'GET',
            contentType: "application/json; charset=utf-8",
            async: true,
            dataType: 'json',
            success: function (data) {
                createProcessDiagram(data);
            }
        });

        $("#showAll").click(function() {
            createAllProcessorInfo();
        });
    });

    function createProcessDiagram(nodesinfo) {

        var container = document.getElementById('network1');
        var data = {
            nodes: nodesinfo
        };
        var options = {
            nodes: {
                shape: 'dot',
                size: 30,
                font: {
                    size: 18,
                    color: '#ffffff'
                },
                borderWidth: 2
            }
        };
        processNetwork = new vis.Network(container, data, options);

        processNetwork.on("click", function (params) {
            if (params.nodes.length > 0) {

                var processName = processNetwork.body.data.nodes._data[params.nodes[0]].label;
                getTasksInfo(processName);
            }
        });
    }

    function getTasksInfo(processName) {
        $.ajax({
            url: '/api/tasks/',
            type: 'GET',
            contentType: "application/json; charset=utf-8",
            async: true,
            dataType: 'json',
            success: function (data) {
                tasksInfo = data;
                createTasksDiagram();
            }
        });
    }

    function createTasksDiagram() {

        var container = document.getElementById('network2');
        var data = {
            nodes: tasksInfo.taskPoints,
            edges: tasksInfo.taskRelations
        };
        var options = {
            nodes: {
                shape: 'dot',
                size: 30,
                font: {
                    size: 16,
                    color: '#ffffff'
                },
                borderWidth: 2
            }
        };
        taskNetwork = new vis.Network(container, data, options);

        taskNetwork.on("click", function (params) {

            if (params.nodes.length > 0) {
                console.log(params.nodes[0]);
                createOneProcessorInfo(params.nodes[0]);
            }
        });
    }

    function createOneProcessorInfo(id) {

        var newPoints = tasksInfo.taskPoints.concat(tasksInfo.processors[id]);
        var newRelations = tasksInfo.taskRelations.concat(tasksInfo.processTaskRelation[id]);

        taskNetwork.setData({
            nodes: newPoints,
            edges: newRelations
        });
    }

    function createAllProcessorInfo() {

        var newPoints = tasksInfo.taskPoints.concat();
        tasksInfo.processors.forEach(function (processorInfo) {
            newPoints = newPoints.concat(processorInfo);
        });

        var newRelations = tasksInfo.taskRelations.concat();
        tasksInfo.processTaskRelation.forEach(function (relations) {
            newRelations = newRelations.concat(relations);
        });

        taskNetwork.setData({
            nodes: newPoints,
            edges: newRelations
        });
    }

</script>
</body>
</html>
